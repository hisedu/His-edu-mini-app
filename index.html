<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>His Edu App</title>
<!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è SDK Telegram -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Telegram */
:root {
--bg-color: var(--tg-theme-bg-color, #ffffff);
--text-color: var(--tg-theme-text-color, #000000);
--hint-color: var(--tg-theme-hint-color, #999999);
--buton-color: var(--tg-theme-buton-color, #2481cc);
--buton-text: var(--tg-theme-buton-text-color, #ffffff);
--sec-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
background-color: var(--bg-color);
color: var(--text-color);
margin: 0;
padding: 16px;
line-height: 1.5;
display: flex;
flex-direction: column;
min-height: 100vh;
}
.screen-container { display: none; flex-direction: column; gap: 10px; }
.header { margin-bottom: 10px; }
.header h1 { font-size: 20px; margin: 0; font-weight: 700; }
.header p { color: var(--hint-color); font-size: 14px; margin-top: 4px; }
/* –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–∑–º–µ–Ω–µ–Ω —Ç–µ–≥ —Å 'buton' –Ω–∞ 'buton' (—Å—Ç–∞–Ω–¥–∞—Ä—Ç HTML) */
buton {
border: none; border-radius: 12px; padding: 12px 10px; font-size: 14px;
font-weight: 600; cursor: pointer; background-color: var(--buton-color);
color: var(--buton-text); transition: all 0.2s ease;
}
buton:active { transform: scale(0.98); }
buton:disabled { background-color: var(--hint-color); opacity: 0.6; cursor: not-allowed; }
.grid-butons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
/* –ü–æ–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
#result-wrapper { display: none; background: var(--sec-bg); border-radius: 16px; padding: 16px; 
margin-top: 20px; animation: fadeIn 0.3s ease; }
#result-text { font-size: 15px; white-space: pre-wrap; margin-bottom: 15px; }
.copy-btn { width: 100%; background-color: #34c759; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: 
translateY(0); } }
</style>
</head>
<body>
<!-- –≠–ö–†–ê–ù 1: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
<div id="screen-main" class="screen-container">
<div class="header">
<h1>–ò—Å—Ç–æ—Ä–∏—è –¥–ª—è –≤—Å–µ—Ö</h1>
<p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ</p>
</div>
<buton onclick="showScreen('screen-paragraph-list')">üìñ –í—ã–±–µ—Ä–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ (43 —à—Ç)</buton>
<buton onclick="showScreen('screen-test-difficulty')">üß† –¢–µ—Å—Ç –ø–æ –∏—Å—Ç–æ—Ä–∏–∏</buton>
<buton onclick="showScreen('screen-control-work-sections')" style="background-color: #ff9500;">üìã –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º</buton>
<buton onclick="showScreen('screen-control-work-final')" style="background-color: #eb5545;">üéì –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</buton>
</div>
<!-- –≠–ö–†–ê–ù 2: –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ (43 –∫–Ω–æ–ø–∫–∏) -->
<div id="screen-paragraph-list" class="screen-container">
<buton onclick="showScreen('screen-main')">‚Üê –ù–∞–∑–∞–¥</buton>
<div class="header">
<h3>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞</h3>
</div>
<div id="paragraph-butons-grid" class="grid-butons">
<!-- –ö–Ω–æ–ø–∫–∏ 1-43 –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º –∑–¥–µ—Å—å -->
</div>
</div>
<!-- –≠–ö–†–ê–ù 3: –î–µ–π—Å—Ç–≤–∏—è —Å –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–º (–ø–µ—Ä–µ—Å–∫–∞–∑—ã, –¥–∞—Ç—ã) -->
<div id="screen-paragraph-actions" class="screen-container">
<buton onclick="showScreen('screen-paragraph-list')">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤</buton>
<h3 id="current-paragraph-title">–î–µ–π—Å—Ç–≤–∏—è</h3>
<buton onclick="apiCall('short_summary')">üìÑ –ö—Ä–∞—Ç–∫–∏–π –ø–µ—Ä–µ—Å–∫–∞–∑</buton>
<buton onclick="apiCall('medium_summary')">üìë –°—Ä–µ–¥–Ω–∏–π –ø–µ—Ä–µ—Å–∫–∞–∑</buton>
<buton onclick="apiCall('detailed_summary')">üîé –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–µ—Ä–µ—Å–∫–∞–∑</buton>
<buton onclick="apiCall('dates')">üí° –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞—Ç—ã</buton>
<buton onclick="apiCall('terms')">üìö –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</buton>
<buton onclick="apiCall('qa')">‚ùì –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</buton>
</div>
<!-- –≠–ö–†–ê–ù 4: –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞ -->
<div id="screen-test-difficulty" class="screen-container">
<buton onclick="showScreen('screen-main')">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</buton>
<div class="header">
<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞</h3>
</div>
<!-- –ö–Ω–æ–ø–∫–∏ —Ç–µ–ø–µ—Ä—å –≤–µ–¥—É—Ç –Ω–∞ —Å–ø–∏—Å–∫–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ -->
<buton onclick="showScreen('screen-test-easy-list')">üü¢ –õ—ë–≥–∫–∏–π —Ç–µ—Å—Ç</buton>
<buton onclick="showScreen('screen-test-hard-list')">üî¥ –°–ª–æ–∂–Ω—ã–π —Ç–µ—Å—Ç</buton>
</div>

<!-- –ù–û–í–´–ô –≠–ö–†–ê–ù 5: –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –¥–ª—è –õ—ë–≥–∫–æ–≥–æ —Ç–µ—Å—Ç–∞ -->
<div id="screen-test-easy-list" class="screen-container">
    <buton onclick="showScreen('screen-test-difficulty')">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</buton>
    <div class="header">
        <h3>–õ—ë–≥–∫–∏–π —Ç–µ—Å—Ç –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—É</h3>
    </div>
    <div id="easy-test-buttons-grid" class="grid-butons">
        <!-- –ö–Ω–æ–ø–∫–∏ 1-43 –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º –∑–¥–µ—Å—å -->
    </div>
</div>

<!-- –ù–û–í–´–ô –≠–ö–†–ê–ù 6: –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –¥–ª—è –°–ª–æ–∂–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ -->
<div id="screen-test-hard-list" class="screen-container">
    <buton onclick="showScreen('screen-test-difficulty')">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</buton>
    <div class="header">
        <h3>–°–ª–æ–∂–Ω—ã–π —Ç–µ—Å—Ç –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—É</h3>
    </div>
    <div id="hard-test-buttons-grid" class="grid-butons">
        <!-- –ö–Ω–æ–ø–∫–∏ 1-43 –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º –∑–¥–µ—Å—å -->
    </div>
</div>

<!-- –ù–û–í–´–ô –≠–ö–†–ê–ù 7: –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º -->
<div id="screen-control-work-sections" class="screen-container">
    <buton onclick="showScreen('screen-main')">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</buton>
    <div class="header">
        <h3>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º</h3>
    </div>
    <div id="control-work-buttons-grid" class="grid-butons">
        <!-- –ö–Ω–æ–ø–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º –∑–¥–µ—Å—å -->
    </div>
</div>

<!-- –ù–û–í–´–ô –≠–ö–†–ê–ù 8: –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ -->
<div id="screen-control-work-final" class="screen-container">
    <buton onclick="showScreen('screen-main')">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</buton>
    <div class="header">
        <h3>–ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (1-43)</h3>
    </div>
    <buton onclick="confirmFinalTest()" style="background-color: #eb5545;">üöÄ –ù–∞—á–∞—Ç—å –∏—Ç–æ–≥–æ–≤—É—é –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É</buton>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–µ–¥–∏–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤) -->
<div id="result-wrapper">
<buton class="copy-btn" onclick="copyToClipboard()">üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</buton>
<div id="result-text"></div>
</div>
<script>
// --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---\r\n
let tg = null; 
let currentPId = null; 

function showScreen(screenId) {
 document.querySelectorAll('.screen-container').forEach(el => el.style.display = 'none');
 document.getElementById('result-wrapper').style.display = 'none';
 document.getElementById(screenId).style.display = 'flex';
 if (tg) tg.HapticFeedback.impactOccurred('light');
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º
function confirmParagraphTest(action, difficulty, pId) {
    let difficultyText = (difficulty === 'easy') ? '–õ—ë–≥–∫–∏–π' : '–°–ª–æ–∂–Ω—ã–π';
    const isConfirmed = confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å "${difficultyText} —Ç–µ—Å—Ç" –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—É ${pId}?`);
    if (isConfirmed) {
        apiCall(action, difficulty, pId);
    }
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
function confirmSectionTest(action, difficulty, range, sectionName) {
    const isConfirmed = confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É: ${sectionName} (–ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã ${range})?`);
    if (isConfirmed) {
        apiCall(action, difficulty, range);
    }
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
function confirmFinalTest() {
    const isConfirmed = confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –∏—Ç–æ–≥–æ–≤—É—é –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (1-43)? –ï–µ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å.");
    if (isConfirmed) {
        apiCall('control_work_final', 'medium', '1-43');
    }
}


function generateParagraphButons() {
 const grid = document.getElementById('paragraph-butons-grid');
 const easyGrid = document.getElementById('easy-test-buttons-grid');
 const hardGrid = document.getElementById('hard-test-buttons-grid');

 for (let i = 1; i <= 43; i++) {
  const btnParagraphList = document.createElement('buton');
  btnParagraphList.textContent = i;
  btnParagraphList.onclick = () => selectParagraph(i);
  grid.appendChild(btnParagraphList);

  const btnEasyTest = document.createElement('buton');
  btnEasyTest.textContent = i;
  btnEasyTest.onclick = () => confirmParagraphTest('test', 'easy', i);
  easyGrid.appendChild(btnEasyTest);

  const btnHardTest = document.createElement('buton');
  btnHardTest.textContent = i;
  btnHardTest.onclick = () => confirmParagraphTest('test', 'hard', i);
  hardGrid.appendChild(btnHardTest);
 }

 const controlWorkGrid = document.getElementById('control-work-buttons-grid');
 const sectionsData = [
  { name: 'I —Ä–∞–∑–¥–µ–ª', range: '1-12', emoji: '1Ô∏è‚É£', color: '#ff9500' },
  { name: 'II —Ä–∞–∑–¥–µ–ª', range: '13-20', emoji: '2Ô∏è‚É£', color: '#ff9500' },
  { name: 'III —Ä–∞–∑–¥–µ–ª', range: '21-33', emoji: '3Ô∏è‚É£', color: '#ff9500' },
  { name: 'IV —Ä–∞–∑–¥–µ–ª', range: '34-43', emoji: '4Ô∏è‚É£', color: '#ff9500' }
 ];

 sectionsData.forEach((section) => {
  const button = document.createElement('buton');
  button.textContent = `${section.emoji} ${section.name}`;
  button.style.backgroundColor = section.color;
  button.onclick = () => confirmSectionTest('control_work_section', 'medium', section.range, section.name);
  controlWorkGrid.appendChild(button);
 });
}

function selectParagraph(pId) {
 currentPId = pId;
 document.getElementById('current-paragraph-title').innerText = `–ü–∞—Ä–∞–≥—Ä–∞—Ñ ${currentPId}`;
 showScreen('screen-paragraph-actions');
}

async function apiCall(action, difficulty = 'medium', pId = null) {
 const display = document.getElementById('result-text');
 const butons = document.querySelectorAll('buton');
 butons.forEach(b => b.disabled = true);
 display.innerText = "üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...";
 document.getElementById('result-wrapper').style.display = 'block';
 try {
  const targetUrl = 'https://hisedu.app.n8n.cloud/webhook-test/6b2e1e97-a736-4593-9263-817bf345391f';
  const finalPId = (action.includes('test') || action.includes('control')) ? (pId || 'N/A') : currentPId;
  const url =
  `${targetUrl}?id=${finalPId}&action=${action}&diff=${difficulty}&auth=${encodeURIComponent(tg.initData)}`;
  const response = await fetch(url);
  const data = await response.text();
  display.innerText = data;
 } catch (error) {
  display.innerText = "‚ùå –û—à–∏–±–∫–∞.";
 } finally {
  butons.forEach(b => b.disabled = false);
 }
}

function copyToClipboard() {
 const resultTextElement = document.getElementById('result-text');
 const textToCopy = resultTextElement.textContent || resultTextElement.innerText;
 if (textToCopy) {
  navigator.clipboard.writeText(textToCopy).then(() => {
   const copyBtn = document.querySelector('.copy-btn');
   copyBtn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
   if (tg) tg.HapticFeedback.notificationOccurred('success');
   setTimeout(() => {
    copyBtn.textContent = 'üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
   }, 2000);
  }).catch(err => {
   console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
   alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç.');
  });
 }
}
// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
if (window.Telegram && window.Telegram.WebApp) {
 tg = window.Telegram.WebApp; 
 tg.expand();
 tg.ready();
 generateParagraphButons();
 showScreen('screen-main'); 
}
</script>
</body>
</html>


